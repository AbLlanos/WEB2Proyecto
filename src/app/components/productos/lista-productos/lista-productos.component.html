<div class="max-w-7xl mx-auto p-4 mt-10">

    <div class="flex justify-end mb-4">
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" (click)="mostrarCarrito = true">
            Ver Pedido ({{ carrito.length }})
        </button>
    </div>

    <h1 class="text-5xl font-bold text-center text-gray-900 mb-5">Lista de productos</h1>

    <!-- Hamburguesas -->
    <h2
        class="text-2xl font-bold text-gray-800 mt-8 mb-4 text-center bg-yellow-200 rounded-xl py-2 px-4 w-full mx-auto">
        Hamburguesas
    </h2>


    <div
        class=" card-producto p-4 bg-gray-200 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 justify-center">

        @for (producto of productos; track producto.id) {
        <div
            class="card-producto w-full max-w-xs mx-auto shadow-xl p-5 transition-transform duration-300 hover:scale-105 h-[580px] flex flex-col justify-between mt-4">
            <div class="overflow-hidden flex flex-col h-full justify-center card-hover ">
                <!-- Nombre y categoría -->
                <div class="seccion1">
                    <h2 class="text-lg font-bold text-yellow-500 mb-1 truncate text-center">{{ producto.nombre }}</h2>
                    <p class="text-sm text-gray-600 text-center">{{ producto.categoria }}</p>
                </div>

                <!-- Imagen -->
                <div class="seccion2">
                    <img [src]="producto.img" alt="{{ producto.nombre }}"
                        class="w-full h-full object-cover rounded-xl shadow-sm" />
                </div>

                <!-- Información -->
                <div class="seccion3 text-sm text-gray-700 space-y-1 px-1">
                    <p><strong>Ingredientes:</strong> {{ producto.ingredientes }}</p>
                    <p><strong>Precio:</strong> ${{ producto.precio }}</p>
                    <p><strong>Total:</strong> ${{ producto.precioTotal }}</p>
                    <p><strong>Cantidad:</strong> {{ producto.cantidad }}</p>
                    <p><strong>Disponible:</strong> {{ producto.disponible }}</p>
                </div>

                <!-- Botones -->
                <button
                    class="w-full font-semibold rounded-xl text-sm px-5 py-2.5 flex items-center justify-center gap-2"
                    [ngClass]="{
    'bg-red-600 hover:bg-red-700 text-white': producto.cantidad > 0,
    'bg-gray-400 text-white cursor-not-allowed': producto.cantidad === 0
  }" [disabled]="producto.cantidad === 0" (click)="agregarAlCarrito(producto)">
                    <span>{{ producto.cantidad === 0 ? 'Agotado' : 'Agregar al Carrito' }}</span>
                </button>


                <!--
                    <button
                        class="w-full mt-2 bg-yellow-400 hover:bg-yellow-500 text-black font-semibold rounded-xl text-sm px-5 py-2.5"
                        [routerLink]="['/editarFormulario', producto.id]">
                        Editar
                    </button>


                    <button
                        class="w-full mt-2 bg-yellow-600 hover:bg-yellow-500 text-black font-semibold rounded-xl text-sm px-5 py-2.5"
                        (click)="eliminarProducto(producto.id)">
                        Eliminar
                    </button>
                    -->
            </div>

        </div>

        }
    </div>
</div>

<!-- Modal -->
<!-- Modal Carrito -->
<div *ngIf="mostrarCarrito" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-bold mb-4">Resumen del Pedido</h2>

        <table class="w-full border mb-4">
            <thead>
                <tr class="bg-gray-100 text-left">
                    <th class="p-2">Producto</th>
                    <th class="p-2">Cantidad</th>
                    <th class="p-2">Precio</th>
                    <th class="p-2">Subtotal</th>
                    <th class="p-2">Total (IVA)</th>
                    <th class="p-2">Acción</th>
                </tr>
            </thead>
            <tbody>
                @for (item of carrito; track item.id) {
                <tr>
                    <td class="p-2">{{ item.nombre }}</td>
                    <td class="p-2">
                        <input type="number" [(ngModel)]="item.cantidad" min="1"
                            (ngModelChange)="item.subtotal = item.precio * item.cantidad; item.total = item.subtotal * (1 + item.iva)">
                    </td>
                    <td class="p-2">${{ item.precio }}</td>
                    <td class="p-2">${{ item.subtotal.toFixed(2) }}</td>
                    <td class="p-2">${{ item.total.toFixed(2) }}</td>
                    <td class="p-2">
                        <button class="text-red-600 hover:underline"
                            (click)="eliminarDelCarrito(item.id)">Eliminar</button>
                    </td>
                </tr>
                }
            </tbody>
        </table>

        <div class="text-right font-semibold mb-4">
            @let totales = calcularTotalesCarrito();
            Subtotal: ${{ totales.subtotal.toFixed(2) }} <br />
            Total con IVA: ${{ totales.total.toFixed(2) }}
        </div>

        <div class="flex justify-end gap-2">
            <button class="bg-gray-500 text-white px-4 py-2 rounded" (click)="mostrarCarrito = false">Cerrar</button>
            <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" (click)="confirmarPedido()">
                Confirmar Pedido
            </button>
        </div>
    </div>
</div>